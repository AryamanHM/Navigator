(function(){var e={271:function(e,t,r){"use strict";var a=r(9242),n=r(3396);const o={id:"app"};function s(e,t,r,a,s,i){const l=(0,n.up)("Planner");return(0,n.wg)(),(0,n.iD)("div",o,[(0,n.Wm)(l)])}const i={class:"container"};function l(e,t,r,a,o,s){const l=(0,n.up)("el-menu-item"),d=(0,n.up)("el-menu"),u=(0,n.up)("el-row"),h=(0,n.up)("places"),c=(0,n.up)("el-form-item"),m=(0,n.up)("el-input"),g=(0,n.up)("el-button"),f=(0,n.up)("el-form"),p=(0,n.up)("el-col"),v=(0,n.up)("l-tile-layer"),y=(0,n.up)("l-map");return(0,n.wg)(),(0,n.iD)("div",i,[(0,n.Wm)(u,null,{default:(0,n.w5)((()=>[(0,n.Wm)(d,{class:"el-menu-demo",mode:"horizontal"},{default:(0,n.w5)((()=>[(0,n.Wm)(l,null,{default:(0,n.w5)((()=>[(0,n.Uk)("EV Recharge Trip Planner")])),_:1})])),_:1})])),_:1}),(0,n.Wm)(u,null,{default:(0,n.w5)((()=>[(0,n.Wm)(p,{xs:24,sm:8,md:6},{default:(0,n.w5)((()=>[(0,n.Wm)(f,{model:o.travelData,ref:"traveldatavalidateform"},{default:(0,n.w5)((()=>[(0,n.Wm)(c,{prop:"startPoint",label:"Departure Address",rules:[{required:!0,message:"Departure address is required",trigger:"blur"}]},{default:(0,n.w5)((()=>[(0,n.Wm)(h,{modelValue:o.travelData.startPoint,"onUpdate:modelValue":t[0]||(t[0]=e=>o.travelData.startPoint=e),placeholder:"Enter Departure Address",id:"startingPoint",onChange:t[1]||(t[1]=e=>s.setAddress("departureAddress",e))},null,8,["modelValue"])])),_:1}),(0,n.Wm)(c,{prop:"arrivalPoint",label:"Arrival Address",rules:[{required:!0,message:"Arrival address is required",trigger:"blur"}]},{default:(0,n.w5)((()=>[(0,n.Wm)(h,{modelValue:o.travelData.arrivalPoint,"onUpdate:modelValue":t[2]||(t[2]=e=>o.travelData.arrivalPoint=e),placeholder:"Enter Arrival Address",id:"arrivalPoint",onChange:t[3]||(t[3]=e=>s.setAddress("arrivalAddress",e))},null,8,["modelValue"])])),_:1}),(0,n.Wm)(c,{label:"Car Autonomy",prop:"carAutonomy",rules:[{required:!0,message:"Autonomy is required (1 - 1000 km)",trigger:"blur"}]},{default:(0,n.w5)((()=>[(0,n.Wm)(m,{type:"number",class:"w-full",placeholder:"N° of km drivable at full recharge","suffix-icon":"el-icon-odometer",modelValue:o.travelData.carAutonomy,"onUpdate:modelValue":t[4]||(t[4]=e=>o.travelData.carAutonomy=e),min:1,max:1e3,step:1,controlls:"true","controls-position":"right"},null,8,["modelValue"])])),_:1},8,["rules"]),(0,n.Wm)(c,null,{default:(0,n.w5)((()=>[(0,n.Wm)(g,{type:"primary",onClick:t[5]||(t[5]=e=>s.main()),id:"button",icon:"el-icon-search",class:"w-1/2",round:""},{default:(0,n.w5)((()=>[(0,n.Uk)("Search")])),_:1}),(0,n.Wm)(g,{type:"primary",onClick:t[6]||(t[6]=e=>s.reset()),id:"reset",icon:"el-icon-remove",class:"w-1/2",round:""},{default:(0,n.w5)((()=>[(0,n.Uk)("Reset")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),(0,n.Wm)(p,{xs:24,sm:16,md:18},{default:(0,n.w5)((()=>[(0,n.Wm)(y,{zoom:o.zoom,center:o.center,id:"map",ref:"map"},{default:(0,n.w5)((()=>[(0,n.Wm)(v,{url:o.url},null,8,["url"])])),_:1},8,["zoom","center"])])),_:1})])),_:1})])}r(7658);var d=r(3153),u=r.n(d),h=r(3258),c=r(8197),m=(r(3540),r(751),r(236));r(3729),r(4243),r(8154),delete u().Icon.Default.prototype._getIconUrl,u().Icon.Default.mergeOptions({iconRetinaUrl:r(6431),iconUrl:r(7093),shadowUrl:r(8858)});const g="d8a4d276-f704-4abb-9ac9-34216374b2a2",f="ElectricPlanner";var p={name:"Planner",components:{LMap:h.iA,LTileLayer:h.Hw,Places:c.Z},data(){return{travelData:{startPoint:null,arrivalPoint:null,carAutonomy:null},startPointCoordinates:{},arrivalPointCoordinates:{},zoom:6,center:u().latLng({lat:41.8719,lng:12.5674}),url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",departureMarker:{},arrivalMarker:{},travelPath:null,finalTravelPath:null,configValues:{radiusIncrementBy:2,batteryPercentageUsage:.7,minRadius:2},markersLayers:u().layerGroup([])}},methods:{async main(){let e=this.$refs["traveldatavalidateform"].validate();e?(u().Control.Geocoder.latLng(this.startPointCoordinates,this.startPointCoordinates),this.travelPath=this.buildTravelPathStartToEnd(),this.travelPath.addTo(this.$refs.map.mapObject),this.travelPath.on("routingerror",this.handleRoutingError),this.travelPath.on("routesfound",await this.handleRoutesFound)):this.$notify.warning({title:"Info",message:"Form data not valid"})},reset(){location.reload()},setAddress(e,t){this.zoom=this.$refs.map.mapObject.getZoom(),"departureAddress"===e?t.latlng?(this.startPointCoordinates=t.latlng,this.departureMarker!=={}&&this.markersLayers.removeLayer(this.departureMarker),this.departureMarker=this.setStartMarker().bindPopup("Departure: "+t.value,{closeOnClick:!1,autoClose:!1}).addTo(this.$refs.map.mapObject).openPopup()):this.markersLayers.removeLayer(this.departureMarker):t.latlng?(this.arrivalPointCoordinates=t.latlng,this.departureMarker!=={}&&this.markersLayers.removeLayer(this.arrivalMarker),this.arrivalMarker=this.setEndMarker().bindPopup("Arrival: "+t.value,{closeOnClick:!1,autoClose:!1}).addTo(this.$refs.map.mapObject).openPopup()):this.markersLayers.removeLayer(this.arrivalMarker)},buildTravelPathStartToEnd(){return this.buildTravelPath([[this.startPointCoordinates.lat,this.startPointCoordinates.lng],[this.arrivalPointCoordinates.lat,this.arrivalPointCoordinates.lng]],!1)},buildTravelPath(e,t){let r=new Array(0);for(let a=0;a<e.length;a++)r.push(u().latLng(e[a][0],e[a][1]));return u().Routing.control({waypoints:r,lineOptions:{styles:[{color:"white",opacity:t?1:0,weight:7},{color:"red",opacity:t?1:0,weight:4}]},routeWhileDragging:!1,addWaypoints:!1,show:t,draggableWaypoints:!1,showAlternatives:t})},handleRoutingError(e){this.$notify.error({title:"Error",message:e.error.message}),this.$refs.map.mapObject.removeControl(this.travelPath)},async handleRoutesFound(e){this.travelPath=e.routes;let t=await this.getPathChargerCoordinates();this.displayResults(t,this.$refs.map.mapObject)},async getPathChargerCoordinates(){let e=!1,t=0,r=[];while(t<this.travelPath.length&&!e){let a=this.travelPath[t],n=a.summary.totalDistance,o=this.travelData.carAutonomy*this.configValues.batteryPercentageUsage/(n/1e3);if(o>=1)return e=!0,[e,[]];let s=Math.ceil(1/o)-1,i=this.calculateDistancesFromRouteCoordinates(a),l=this.getStopCircleCenterPoints(a,i);if(r=await this.obtainChargersForThisRoute(s,l),r.length===s){e=!0;break}t++}return[e,r]},async getChargerData(e){let t=await m.ZP.get(e);return t.data},async obtainChargersForThisRoute(e,t){let r=this.travelData.carAutonomy*((1-this.configValues.batteryPercentageUsage)/2),a=this.configValues.minRadius,n=0,o=new Array(0);while(n<e&&a<=r){let e=new Array(0),r=new Array(0),s=this.buildURL(t[n],a);if(e=await this.getChargerData(s),void 0===e||0===e.length){a*=this.configValues.radiusIncrementBy;continue}for(let a=0;a<e.length;a++)r.push(this.getDistanceFromLatLonInKm(t[n][0],t[n][1],e[a].AddressInfo.Latitude,e[a].AddressInfo.Longitude));let i=this.getSmallestElementsIndex(r);o.push(e[i]),a=this.configValues.minRadius,n++}return o},getDistanceFromLatLonInKm(e,t,r,a){const n=6371;let o=(r-e)*(Math.PI/180),s=(a-t)*(Math.PI/180),i=Math.sin(o/2)*Math.sin(o/2)+Math.cos(e*(Math.PI/180))*Math.cos(r*(Math.PI/180))*Math.sin(s/2)*Math.sin(s/2),l=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i));return n*l},calculateDistancesFromRouteCoordinates(e){let t=new Array(0);for(let r=1;r<e.coordinates.length;r++){let a=this.getDistanceFromLatLonInKm(e.coordinates[r-1].lat,e.coordinates[r-1].lng,e.coordinates[r].lat,e.coordinates[r].lng);t.push(a)}return t},getStopCircleCenterPoints(e,t){let r=new Array(0),a=0,n=0,o=0,s=0;for(let i=0;i<t.length;i++)if(a+t[i]<this.travelData.carAutonomy*this.configValues.batteryPercentageUsage)a+=t[i];else{o=this.travelData.carAutonomy*this.configValues.batteryPercentageUsage-a,s=o/t[i];let l=e.coordinates[i].lat+(e.coordinates[i].lat-e.coordinates[i+1].lat)*s,d=e.coordinates[i].lng+(e.coordinates[i].lng-e.coordinates[i+1].lng)*s;if(r.push([l,d]),n=t[i]-o,n<=this.travelData.carAutonomy*this.configValues.batteryPercentageUsage)a=n;else{while(n>=this.travelData.carAutonomy*this.configValues.batteryPercentageUsage)o=n-this.travelData.carAutonomy*this.configValues.batteryPercentageUsage,s=this.travelData.carAutonomy*this.configValues.batteryPercentageUsage/n,l+=(l-e.coordinates[i+1].lat)*s,d+=(d-e.coordinates[i+1].lng)*s,r.push([l,d]),n-=this.travelData.carAutonomy*this.configValues.batteryPercentageUsage;a=n}}return r},buildURL(e,t){return"https://api.openchargemap.io/v3/poi/?client="+f+"&key="+g+"&output=json&latitude="+e[0]+"&longitude="+e[1]+"&distance="+t+"&distanceunit=KM&maxresults=100"},getSmallestElementsIndex(e){if(0===e.length)return null;let t=e[0],r=0;for(let a=1;a<e.length;a++)t>e[a]&&(t=e[a],r=a);return r},displayResults(e){let t=e[1];if(e[0]){for(let r=0;r<t.length;r++)this.setChargerMarker([t[r].AddressInfo.Latitude,t[r].AddressInfo.Longitude]).bindTooltip(this.buildStringForTooltip(t,r),{interactive:!0,permanent:!0,opacity:.7}).addTo(this.$refs.map.mapObject).openTooltip();let e=new Array(0);return e.push([this.startPointCoordinates.lat,this.startPointCoordinates.lng]),t.forEach((function(t){e.push([t.AddressInfo.Latitude,t.AddressInfo.Longitude])})),e.push([this.arrivalPointCoordinates.lat,this.arrivalPointCoordinates.lng]),this.finalTravelPath=this.buildTravelPath(e,!0),this.finalTravelPath.addTo(this.$refs.map.mapObject),2!==e.length||(this.$notify.success({title:"Info",message:"No recharge needed"}),!0)}return this.$notify.warning({title:"Info",message:"It wasn't possible to find an itinerary with chargers"}),!1},buildStringForTooltip(e,t){let r=null===e[t].AddressInfo.Title?"":e[t].AddressInfo.Title,a=null===e[t].AddressInfo.AddressLine1?"":e[t].AddressInfo.AddressLine1,n=null===e[t].AddressInfo.AddressLine2?"":e[t].AddressInfo.AddressLine2,o=null===e[t].AddressInfo.Town?"":e[t].AddressInfo.Town,s=null===e[t].AddressInfo.StateOrProvince?"":e[t].AddressInfo.StateOrProvince,i=null===e[t].AddressInfo.Postcode?"":e[t].AddressInfo.Postcode,l=null===e[t].AddressInfo.Country.Title?"":e[t].AddressInfo.Country.Title,d=null===e[t].OperatorInfo.Title?"":e[t].OperatorInfo.Title,u=null===e[t].UsageCost?"":e[t].UsageCost,h=e[t].AddressInfo.Latitude.toFixed(4),c=e[t].AddressInfo.Longitude.toFixed(4),m=null===e[t].AddressInfo.NumberOfPoints?"1":e[t].AddressInfo.NumberOfPoints,g="Recharge at: "+r+"<br>in: "+a+" "+n+" - "+o+", "+s+" "+i+", "+l+"<br>Operator: "+d+" Cost: "+u+"<br>Lat: "+h+" Long: "+c+" N° of plugs: "+m;return g},setStartMarker(){return this.setMarker(this.startPointCoordinates,"startPoint")},setEndMarker(){return this.setMarker(this.arrivalPointCoordinates,"endPoint")},setChargerMarker(e){return this.setMarker(e,"charger")},setMarker(e,t){if(0===this.markersLayers.getLayers().length&&this.markersLayers.addTo(this.$refs.map.mapObject),"startPoint"===t){let e=u().marker(this.startPointCoordinates,{draggable:!1,bounceOnAdd:!0});return this.markersLayers.addLayer(e),e}if("endPoint"===t){let e=u().marker(this.arrivalPointCoordinates,{draggable:!1,bounceOnAdd:!0});return this.markersLayers.addLayer(e),e}if("charger"===t){let t=new(u().Icon)({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),r=u().marker(e,{icon:t,draggable:!1,bounceOnAdd:!0});return this.markersLayers.addLayer(r),r}return null}}},v=r(89);const y=(0,v.Z)(p,[["render",l]]);var P=y,b={name:"app",components:{Planner:P}};const A=(0,v.Z)(b,[["render",s]]);var w=A;(0,a.ri)(w).mount("#app")},5525:function(){}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var o=t[a]={exports:{}};return e[a].call(o.exports,o,o.exports,r),o.exports}r.m=e,function(){var e=[];r.O=function(t,a,n,o){if(!a){var s=1/0;for(u=0;u<e.length;u++){a=e[u][0],n=e[u][1],o=e[u][2];for(var i=!0,l=0;l<a.length;l++)(!1&o||s>=o)&&Object.keys(r.O).every((function(e){return r.O[e](a[l])}))?a.splice(l--,1):(i=!1,o<s&&(s=o));if(i){e.splice(u--,1);var d=n();void 0!==d&&(t=d)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[a,n,o]}}(),function(){r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,{a:t}),t}}(),function(){r.d=function(e,t){for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};r.O.j=function(t){return 0===e[t]};var t=function(t,a){var n,o,s=a[0],i=a[1],l=a[2],d=0;if(s.some((function(t){return 0!==e[t]}))){for(n in i)r.o(i,n)&&(r.m[n]=i[n]);if(l)var u=l(r)}for(t&&t(a);d<s.length;d++)o=s[d],r.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return r.O(u)},a=self["webpackChunknavigator"]=self["webpackChunknavigator"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=r.O(void 0,[998],(function(){return r(271)}));a=r.O(a)})();
//# sourceMappingURL=app.94ab3939.js.map